\newpage
\restoregeometry
%\renewcommand{\lstlistlistingname}{Quellcodeverzeichniss}
\renewcommand{\lstlistingname}{Quellcode}
%\lstlistoflistings
\section{Quellcodeverzeichnis}

\subsection{Konfiguration von Werkzeug auf HTTP 1.1}
\begin{lstlisting}[caption={Konfiguration von Werkzeug auf HTTP 1.1}, style = Python]
    from flask import Flask
    from werkzeug.serving import WSGIRequestHandler
    from werkzeug.serving import BaseWSGIServer
    WSGIRequestHandler.protocol_version = "HTTP/1.1"
    BaseWSGIServer.protocol_version = "HTTP/1.1"
\end{lstlisting}\label{appendixconfWerkzeug}

\subsection{Quellcode Landing Page Endpoint}
\begin{lstlisting}[caption={Landing Page Endpoint}, style = Python]
#landingpage endpoint
@app.route('/',  methods = ['GET'])
def getLandingPage():
    app.logger.info('/') 
    try:
        if(request.content_type == "text/html" or
        request.args.get('f')=="text/html" or 
        request.args.get('f') == None):
                response = render_template('html/landingPage.html') 
                return response, 200, {
                "link": "localhost:5000/?f=text/html", 
                "resource": "landingPage"
                } 
        elif(request.content_type == "application/json" or
        request.args.get('f')=="application/json"): 
            file = open('templates/json/landingPage.json',) 
            payload = json.load(file) 
            file.close() 
            response = jsonify(payload) 
            return response, 200, {
                "link": "localhost:5000/?f=application/json", 
                "resource": "landingPage"} 
        else:
            return "HTTP status code 406: not acceptable", 406 
        except:
            return "HTTP status code 500: internal server error", 500 
\end{lstlisting}\label{appendixLandingPage}

\newpage
\subsection{Quellcode API Definition Endpoint}
\begin{lstlisting}[caption={API Definition Endpoint}, style = Python]
#api endpoint
@app.route('/api',  methods = ['GET']) 
def getAPIDefinition():
    app.logger.info('/api') 
    try:
        if(request.content_type == "text/html" or
        request.args.get('f')=="text/html" or 
        request.args.get('f') == None): 
            response = render_template('html/apiDefinition.html') 
            return response, 200, {
                "link": "localhost:5000/apiDefinition?f=text/html", 
                "resource": "apiDefinition"} 
        elif(request.content_type == "application/json" or 
        request.args.get('f')=="application/json"): 
            file = open('templates/json/apiDefinition.json',) 
            payload = json.load(file) 
            file.close() #close apiDefinition.json
            response = jsonify(payload) 
            return response, 200, {
                "link": "localhost:5000/api?f=application/json", 
                "resource": "apiDefinition"} 
        else:
            return "HTTP status code 406: not acceptable", 406 
    except:
        return "HTTP status code 500: internal server error", 500
\end{lstlisting}\label{appendixAPIDefinition}

\newpage
\subsection{Quellcode Conformance Endpoint}
\begin{lstlisting}[caption={Conformance Endpoint}, style = Python]
#conformance endpoint
@app.route('/conformance',  methods = ['GET'])
def getConformance():
    app.logger.info('/conformance') 
    try:
        if(request.content_type == "text/html" or 
        request.args.get('f')=="text/html" or 
        request.args.get('f') == None): 
            response = render_template('html/confClasses.html') 
            return response, 200, {
                "link": "localhost:5000/conformance?f=text/html", 
                "resource": "conformance"}
        elif(request.content_type == "application/json" or 
        request.args.get('f')=="application/json"): 
            file = open('templates/json/confClasses.json',)
            payload = json.load(file) 
            file.close() 
            response = jsonify(payload) 
            return response, 200, {
                "link": "localhost:5000/conformance?f=application/json",
                "resource": "conformance"} 
        else:
            return "HTTP status code 406: not acceptable", 406 
    except:
        return "HTTP status code 500: internal server error", 500
\end{lstlisting}\label{appendixConformance}   

\newpage
\subsection{Quellcode Process List Endpoint}
\begin{lstlisting}[caption={Process List Endpoint}, style = Python]
#processes endpoint
@app.route('/processes', methods = ['GET']) 
def getProcesses():
    app.logger.info('/processes') 
    if(request.args.get('limit') == None or 
        int(request.args.get('limit')) <= 0 or 
        int(request.args.get('limit')) > 1000): 
        limit = 10 #set limit to default value
    else:
        limit = int(request.args.get('limit'))
    try:
        if(request.content_type == "text/html" or
            request.args.get('f')=="text/html" or 
            request.args.get('f') == None): 
                processList = [] #initialize list of processes
                processDescriptions = os.listdir("templates/json/processes") 
                counter = 0
                for i in processDescriptions:
                    file = open('templates/json/processes/' + i,) 
                    process = json.load(file) 
                    file.close() 
                    processList.append(process) 
                    counter += 1 
                    if(counter == limit): 
                        break 
                response = render_template('html/processes.html', 
                    processes=processList) 
                return response, 200, {
                    "link": "localhost:5000/processes?f=text/html", 
                    "resource": "processes"} 
        elif(request.content_type == "application/json" or 
                request.args.get('f')=="application/json"): 
            processList = [] #initialize list of processes
            processDescriptions = os.listdir("templates/json/processes")     
            for i in processDescriptions: 
                file = open('templates/json/processes/' + i,) 
                process = json.load(file) 
                file.close() 
                processList.append(process) 
            processes = {"processes": processList[0:limit],
                        "links": [ #add links to self and alternate
                            {
                            "href": "localhost:5000/processes?f=applicattion/json",
                            "rel": "self",
                            "type": "application/json"
                            },
                            {
                            "href": "localhost:5000/processes?f=text/html",
                            "rel": "alternate",
                            "type": "text/html"
                            }
                        ]}
            response = jsonify(processes) 
            return response, 200, {
                "link": "localhost:5000/processes?f=application/json", 
                "resource": "processes"} 
        else:
            return "HTTP status code 406: not acceptable", 406 
    except:
        return "HTTP status code 500: internal server error", 500 
\end{lstlisting}\label{appendixProcessList}   

\newpage
\subsection{Quellcode Process Description Endpoint}
\begin{lstlisting}[caption={Process Description Endpoint}, style = Python]
#process endpoint
@app.route('/processes/<processID>', methods = ['GET']) 
def getProcess(processID):
    app.logger.info('/processes/' + processID) 
    try:
        if(request.content_type == "text/html" or 
            request.args.get('f')=="text/html" or 
            request.args.get('f') == None): 
            if(os.path.exists('templates/json/processes/' 
            + str(processID) + 'ProcessDescription.json')): 
                file = open('templates/json/processes/' 
                + str(processID) 
                + 'ProcessDescription.json',) 
                process = json.load(file) 
                file.close() 
                response = render_template("html/Process.html", process=process) 
                return response, 200, {"link": "localhost:5000/processes/" 
                + str(processID) 
                + "?f=text/html", 
                "resource": str(processID)} 
            else:
                exception = render_template('html/exception.html', 
                title="No such process exception", 
                description="Requested process could not be found", 
                type="no-such-process")
                return exception, 404, {"resource": "no-such-process"}
        elif(request.content_type == "application/json" or
                request.args.get('f')=="application/json"): 
            if(os.path.exists('templates/json/processes/' 
            + str(processID) 
            + 'ProcessDescription.json')): 
                file = open('templates/json/processes/' 
                + str(processID) 
                + 'ProcessDescription.json',)
                payload = json.load(file) 
                file.close() 
                response = jsonify(payload) 
                return response, 200, {"link": "localhost:5000/processes/" 
                + str(processID) 
                + "?f=application/json", 
                "resource": str(processID)} 
            else:
                exception = {"title": "No such process exception", 
                "description": "Requested process could not be found", 
                "type": "no-such-process"}
                return exception, 404, {"resource": "no-such-process"} 
        else:
            return "HTTP status code 406: not acceptable", 406
    except:
        return "HTTP status code 500: internal server error", 500 
\end{lstlisting}\label{appendixProcessDescription}      

\newpage
\subsection{Quellcode Process Execution Endpoint}
\begin{lstlisting}[caption={Process Execution}, style = Python]
@app.route('/processes/<processID>/execution', methods = ['POST']) 
def executeProcess(processID):
    app.logger.info('/processes/' + processID + '/execution') 
    try:
        if(os.path.exists('templates/json/processes/' 
        + str(processID) 
        + 'ProcessDescription.json')): 
            data = json.loads(request.data.decode('utf8').replace("'", '"')) 
            inputParameters = utils.parseInput(processID, data)
            if(inputParameters == False):
                return "HTTP status code 400: bad request", 400 
            jobID = str(uuid.uuid4()) 
            created = str(datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"))
            os.mkdir("jobs/" + jobID) 
            os.mkdir("jobs/" + jobID + "/results/") 

            job_file = {"jobID": str(jobID), 
                        "processID": str(processID), 
                        "input": inputParameters[0], 
                        "output": inputParameters[2],
                        "responseType": inputParameters[1], 
                        "path": "jobs/" + jobID, 
                        "results": "jobs/" + jobID + "/results/", 
                        "downloads": "jobs/" + jobID + "/downloads/"} 
            json.dumps(job_file, indent=4) 
            with open("jobs/" + jobID + "/job.json", 'w') as f: 
                json.dump(job_file, f) 
            f.close()

            status_file = {"jobID": str(jobID), 
                            "processID": str(processID), 
                            "status": "accepted", 
                            "message": "Step 0/1", 
                            "type": "process", 
                            "progress": 0, 
                            "created": created, 
                            "started": "none", 
                            "finished": "none", 
                            "links": [ 
                                {
                                "href": "localhost:5000/jobs/" 
                                + jobID + "?f=application/json",
                                "rel": "self",
                                "type": "application/json",
                                "title": "this document as JSON"},
                                {
                                "href": "localhost:5000/jobs/" 
                                + jobID + "?f=text/html",
                                "rel": "alternate",
                                "type": "text/html",
                                "title": "this document as HTML"
                                }
                            ]}
            json.dumps(status_file, indent=4) #dump content
            with open("jobs/" + jobID + "/status.json", 'w') as f: #create file
                json.dump(status_file, f) #write content
            f.close() #close file

            response = jsonify(status_file) #create response
            return response, 201, {"location": "localhost:5000/jobs/" 
            + jobID + "?f=application/json", 
            "resource": "job"} 
            exception = {"title": "No such process exception", 
            "description": "Requested process could not be found", 
            "type": "no-such-process"}
            return exception, 404 
    except:
        return "HTTP status code 500: internal server error", 500
\end{lstlisting}\label{appendixProcessExecution}   

\newpage
\subsection{Quellcode Echo Process}
\begin{lstlisting}[caption={Echo Process}, style = Python]
def echoProcess(job):
    if(checkForDismissal(job.path + '/status.json') == True):
        return
    
    setStarted(job.path + '/status.json')
    
    try:
        input = job.input[0]
        time.sleep(5)
    except:
        updateStatus(job.path + '/status.json', "failed", "The job has failed", "-")
        return
    
    if(checkForDismissal(job.path + '/status.json') == True):
        return
    
    result ={"result": input,
             "message": "This is an echo"}
    json.dumps(result, indent=4)
    with open(job.results + "result.json", 'w') as f: #create file
        json.dump(result, f) #write content
        f.close() #close file
    updateStatus(job.path + '/status.json', "successful", "Step 1 of 1 completed", "100")
    setFinished(job.path + '/status.json')
\end{lstlisting}\label{appendixEchoProcess}  

\section{Schemata}
\renewcommand{\lstlistingname}{Schema}
\subsection{landingPage.yaml}
\begin{lstlisting}[caption={landingPage.yaml}]
type: object
required:
  - links
properties:
  title:
    type: string
    example: Example processing server
  description:
    type: string
    example: Example server 
  links:
    type: array
    items:
      $ref: "link.yaml"
\end{lstlisting}\label{appendixlandngPageyaml}  

\subsection{processList.yaml}
\begin{lstlisting}[caption={processList.yaml}]
type: object
required:
  - processes
  - links
properties:
  processes:
    type: array
    items:
      $ref: "processSummary.yaml"
  links:
    type: array
    items:
      $ref: "link.yaml"
\end{lstlisting}\label{appendixprocessListyaml}  

\subsection{limit.yaml}
\begin{lstlisting}[caption={limit.yaml}]
name: limit
in: query
required: false
schema:
  type: integer
  minimum: 1
  maximum: 10000
  default: 10
style: form
explode: false
\end{lstlisting}\label{appendixlimityaml}  

\subsection{link.yaml}
\begin{lstlisting}[caption={link.yaml}]
type: object
required:
  - href
properties:
  href:
    type: string
  rel:
    type: string
    example: service
  type:
    type: string
    example: application/json
  hreflang:
    type: string
    example: en
  title:
    type: string
\end{lstlisting}\label{appendixlinkyaml}  

\section{Ressourcen}
\renewcommand{\lstlistingname}{Ressource}
\subsection{landingPage.html}
\begin{lstlisting}[caption={landingPage.html}, style = HTML]
<!DOCTYPE html>
<html>
	<body>
	<h1>links:</h1>
		<p>
			href:<a href="localhost:5000/?f=text/html">
            localhost:5000/?f=text/html</a><br>
			rel: self<br>
			type: text/html<br>
			title: This document as HTML
		</p>
		<p>
			href:<a href="localhost:5000/?f=application/json">
            localhost:5000/?f=application/json</a><br>
			rel: alternate<br>
			type: application/json<br>
			title: This document as JSON 
		</p>
		<p>
			href:<a href="localhost:5000/api?f=application/json">
            localhost:5000/apiDefinition?f=application/json</a><br>
			rel: service-desc<br>
			type: application/json<br>
			title: API definition for this endpoint as JSON
		</p>
		<p>
			href:<a href="localhost:5000/api?f=text/html">
            localhost:5000/apiDefinition?f=text/html</a><br>
			rel: service-desc<br>
			type: text/html<br>
			title: API definition for this endpoint as HTML
		</p>
		<p>
			href:<a href="localhost:5000/conformance?f=application/json">
            localhost:5000/conformance?f=application/json</a><br>
			rel: conformance<br>
			type: application/json<br>
			title: OGC API - Processes conformance classes implemented by this server as JSON
		</p>
		<p>
			href:<a href="localhost:5000/conformance?f=text/html">
            localhost:5000/conformance?f=text/html</a><br>
			rel: conformance<br>
			type: text/html<br>
			title: OGC API - Processes conformance classes implemented by this server as HTML
		</p>
		<p>
			href:<a href="localhost:5000/processes?f=application/json">
            localhost:5000/processes?f=application/json</a><br>
			rel: processes<br>
			type: application/json<br>
			title: Metadata about the processes as JSON
		</p>
		<p>
			href:<a href="localhost:5000/processes?f=text/html">
            localhost:5000/processes?f=text/html</a><br>
			rel: processes<br>
			type: text/html,<br>
			title: Metadata about the processes as HTML
		</p>
		<p>
			href:<a href="localhost:5000/jobs?f=application/json">
            localhost:5000/jobs?f=application/json</a><br>
			rel: jobs<br>
			type: application/json<br>
			title: The endpoint for job monitoring as JSON
		</p>
		<p>
			href:<a href="localhost:5000/jobs?f=text/html">
            localhost:5000/jobs?f=text/html</a><br>
			rel: jobs<br>
			type: text/html<br>
			title: The endpoint for job monitoring as HTML
		</p>
		<p>
			href:<a href="localhost:5000/coverage?f=application/json">
            localhost:5000/coverage?f=application/json</a><br>
			rel: coverage<br>
			type: application/json<br>
			title: The endpoint for coverage as JSON
		</p>
		<p>
			href:<a href="localhost:5000/coverage?f=text/html">
            localhost:5000/coverage?f=text/html</a><br>
			rel: coverage<br>
			type: text/html<br>
			title: The endpoint for coverage as HTML
		</p>
	</body>
</html>
\end{lstlisting}\label{appendixlandingPageHTML}  

\subsection{landingPage.json}
\begin{lstlisting}[caption={landingPage.json}, style = JSON]
{
    "links": [
    {
        "href": "localhost:5000/?f=application/json",
        "rel": "self",
        "type": "application/json",
        "title": "This document"
    },{
        "href": "localhost:5000/?f=text/html",
        "rel": "alternate",
        "type": "text/html",
        "title": "This document as HTML"
    },
    {
        "href": "localhost:5000/api?f=application/json",
        "rel": "service-desc",
        "type": "application/json",
        "title": "API definition for this endpoint as JSON"
    },
    {
        "href": "localhost:5000/api?f=text/html",
        "rel": "service-desc",
        "type": "text/html",
        "title": "API definition for this endpoint as HTML"
    },
    {
        "href": "localhost:5000/conformance?f=application/json",
        "rel": "conformance",
        "type": "application/json",
        "title": "OGC API - Processes conformance classes implemented by this server as JSON"
    },
    {
        "href": "localhost:5000/conformance?f=text/html",
        "rel": "conformance",
        "type": "text/html",
        "title": "OGC API - Processes conformance classes implemented by this server as HTML"
    },
    {
        "href": "localhost:5000/processes?f=application/json",
        "rel": "processes",
        "type": "application/json",
        "title": "Metadata about the processes as JSON"
    },
        {
        "href": "localhost:5000/processes?f=text/html",
        "rel": "processes",
        "type": "text/html",
        "title": "Metadata about the processes as HTML"
    },
    {
        "href": "localhost:5000/jobs?f=application/json",
        "rel": "jobs",
        "type": "application/json",
        "title": "The endpoint for job monitoring as JSON"
    },
        {
        "href": "localhost:5000/jobs?f=text/html",
        "rel": "jobs",
        "type": "text/html",
        "title": "The endpoint for job monitoring as HTML"
    },
    {
        "href": "localhost:5000/coverage?f=application/json",
        "rel": "coverage",
        "type": "application/json",
        "title": "The endpoint for coverage as JSON"
    },
        {
        "href": "localhost:5000/coverage?f=text/html",
        "rel": "coverage",
        "type": "text/html",
        "title": "The endpoint for coverage as HTML"
    }
    ]
}
\end{lstlisting}\label{appendixlandingPageJSON}  